{% extends "layout.html" %}
{% block content %}
  <div class="card">
    <div class="card-header-row">
      <div>
        <h1 class="card-title">Edit inspection</h1>
        <p class="subtle">
          Registration {{ inspection.registration_number }}
          {% if inspection.dealer_name %} Â· {{ inspection.dealer_name }}{% endif %}
        </p>
      </div>
      <div>
        <a href="{{ url_for('view_pdf', inspection_id=inspection.id) }}" class="btn-secondary" target="_blank">
          Open PDF
        </a>
      </div>
    </div>

    <form method="post">
      <div class="form-grid">
        <label class="field">
          <span class="field-label">Cost estimate</span>
          {% if role == 'admin' %}
            <input type="number" step="1" min="0" name="cost_estimate"
                   value="{{ inspection.cost_estimate if inspection.cost_estimate is not none else '' }}">
          {% else %}
            <input type="number" step="1" min="0" disabled
                   value="{{ inspection.cost_estimate if inspection.cost_estimate is not none else '' }}">
          {% endif %}
        </label>

        <label class="field">
          <span class="field-label">Accepted cost</span>
          {% if role == 'reviewer' %}
            <input type="number" step="1" min="0" name="accepted_cost"
                   value="{{ inspection.accepted_cost if inspection.accepted_cost is not none else '' }}">
          {% else %}
            <input type="number" step="1" min="0" disabled
                   value="{{ inspection.accepted_cost if inspection.accepted_cost is not none else '' }}">
          {% endif %}
        </label>

        {% if role == 'admin' %}
          <label class="field">
            <span class="field-label">Admin status</span>
            <select name="status_admin">
              {% for s in admin_statuses %}
                <option value="{{ s }}" {% if inspection.status_admin == s %}selected{% endif %}>{{ s }}</option>
              {% endfor %}
            </select>
          </label>
        {% else %}
          <label class="field">
            <span class="field-label">Reviewer status</span>
            <select name="status_reviewer">
              {% for s in reviewer_statuses %}
                <option value="{{ s }}" {% if inspection.status_reviewer == s %}selected{% endif %}>{{ s }}</option>
              {% endfor %}
            </select>
          </label>
        {% endif %}
      </div>

      <div class="form-grid">
        {% if role == 'admin' %}
          <label class="field">
            <span class="field-label">Admin comment</span>
            <textarea name="comment_admin" placeholder="Notes for reviewer">{{ inspection.comment_admin or '' }}</textarea>
          </label>
        {% else %}
          <label class="field">
            <span class="field-label">Reviewer comment</span>
            <textarea name="comment_reviewer" placeholder="Notes for admin">{{ inspection.comment_reviewer or '' }}</textarea>
          </label>
        {% endif %}
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary">Save changes</button>
        <a href="{{ url_for('list_inspections') }}" class="btn-ghost">Back to list</a>
      </div>
    </form>
  </div>
{% endblock %}
